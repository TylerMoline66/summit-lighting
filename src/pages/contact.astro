---
import BaseLayout from "../layouts/BaseLayout.astro";
---
<BaseLayout title="Contact">
  <section class="section container">
    <div class="section-head">
      <h1>Get in touch</h1>
      <p class="muted">Schedule your free consultation or reach out to us using the contact information below.</p>
    </div>

    <!-- Calendly Booking -->
    <div class="booking-container" style="margin-bottom: var(--space-8);">
      <div class="surface" style="padding: var(--space-6); border: 2px solid var(--warm-amber-glow); border-radius: var(--radius-lg);">
        <button class="booking-toggle" onclick="toggleBooking(this)">
          <div>
            <h2 style="margin: 0; color: var(--warm-amber-glow);">üìÖ Book Your Free Consultation</h2>
            <p class="muted" style="margin: var(--space-2) 0 0 0;">Choose a time that works for you and let's discuss your holiday lighting vision!</p>
          </div>
          <span class="booking-icon">+</span>
        </button>
        <div class="booking-content">
          <div style="display: flex; justify-content: center; width: 100%; padding-top: var(--space-4);">
            <div class="calendly-inline-widget" data-url="https://calendly.com/jarrod-summitholidaylighting/christmas-light-estimate" style="width:100%;height:700px;"></div>
          </div>
          <script type="text/javascript" src="https://assets.calendly.com/assets/external/widget.js" async></script>
        </div>
      </div>
    </div>

    <!-- Contact Information Cards -->
    <div class="contact-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: var(--space-5); margin-bottom: var(--space-8);">
      <div class="surface" style="padding: var(--space-6); text-align: center;">
        <h3 style="color: var(--color-brand); margin-bottom: var(--space-3);">üìû Phone</h3>
        <p class="muted" style="margin-bottom: var(--space-3);">Call for immediate assistance</p>
        <a href="tel:+1-780-995-9653" style="color: var(--color-text); text-decoration: none; font-weight: 600; font-size: 1.1rem;">+1 (780) 995-9653</a>
      </div>
      
      <div class="surface" style="padding: var(--space-6); text-align: center;">
        <h3 style="color: var(--color-brand); margin-bottom: var(--space-3);">üìß Email</h3>
        <p class="muted" style="margin-bottom: var(--space-3);">Send us a detailed message</p>
        <a href="mailto:jarrod@summitholidaylighting.ca" style="color: var(--color-text); text-decoration: none; font-weight: 600; font-size: 1.1rem;">jarrod@summitholidaylighting.ca</a>
      </div>
      
      <div class="surface" style="padding: var(--space-6); text-align: center;">
        <h3 style="color: var(--color-brand); margin-bottom: var(--space-3);">‚è∞ Response Time</h3>
        <p class="muted" style="margin-bottom: var(--space-3);">We typically respond within</p>
        <span style="color: var(--color-text); font-weight: 600; font-size: 1.1rem;">24 hours</span>
      </div>
    </div>

    <!-- Contact Form (Static) -->
    <div class="form">
      <div class="form-card">
        <h3 style="margin-bottom: var(--space-5); text-align: center;">Get your free custom estimate</h3>
        <p class="muted" style="text-align: center; margin-bottom: var(--space-4);">Your estimate is 100% free and comes with no obligation.</p>
        <p class="muted" style="text-align: center; margin-bottom: var(--space-6);">Fill out the form below and we'll get back to you within 24 hours.</p>
        
        <form id="contactForm">
          <div class="form-row two">
            <div>
              <label for="name">Name</label>
              <input id="name" class="input" type="text" name="name" placeholder="Your full name" required />
            </div>
            <div>
              <label for="email">Email</label>
              <input id="email" class="input" type="email" name="email" placeholder="your@email.com" required />
            </div>
          </div>
          <div class="form-row">
            <div>
              <label for="phone">Phone</label>
              <input id="phone" class="input" type="tel" name="phone" placeholder="(555) 123-4567" />
            </div>
          </div>
          <div class="form-row">
            <div>
              <label for="address">Property Address (Optional)</label>
              <input id="address" class="input" type="text" name="address" placeholder="123 Main St, City, State" />
            </div>
          </div>
          <div class="form-row">
            <div>
              <label for="message">Tell us about your home</label>
              <textarea id="message" class="textarea" name="message" rows="4" placeholder="Brief description of your home and lighting preferences..." required></textarea>
              <p class="helper">‚ú® We'll respond within 24 hours with a custom quote</p>
            </div>
          </div>
          <div class="form-actions">
            <button type="submit" class="btn btn-primary">üìß Send Message</button>
          </div>
        </form>
      </div>
    </div>
  </section>
</BaseLayout>

<script>
  // Custom Toast Implementation
  function showToast(message, type = 'success') {
    // Create toast container if it doesn't exist
    let container = document.getElementById('toast-container');
    if (!container) {
      container = document.createElement('div');
      container.id = 'toast-container';
      container.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 10000;
        pointer-events: none;
      `;
      document.body.appendChild(container);
    }

    // Create toast element
    const toast = document.createElement('div');
    toast.style.cssText = `
      background: var(--color-surface);
      color: var(--color-text);
      border: 1px solid var(--color-border);
      border-left: 4px solid ${type === 'success' ? 'var(--summit-gold)' : type === 'error' ? '#e74c3c' : type === 'warning' ? 'var(--warm-amber-glow)' : 'var(--accent-star)'};
      border-radius: var(--radius-md);
      box-shadow: var(--shadow-lg);
      backdrop-filter: blur(10px);
      font-family: var(--font-family);
      font-weight: 500;
      padding: 16px 20px;
      margin-bottom: 10px;
      max-width: 400px;
      opacity: 0;
      transform: translateX(100%);
      transition: all 0.3s ease-out;
      pointer-events: auto;
    `;
    
    toast.textContent = message;
    container.appendChild(toast);

    // Animate in
    setTimeout(() => {
      toast.style.opacity = '1';
      toast.style.transform = 'translateX(0)';
    }, 10);

    // Auto remove after duration
    const duration = type === 'success' ? 5000 : 4000;
    setTimeout(() => {
      toast.style.opacity = '0';
      toast.style.transform = 'translateX(100%)';
      setTimeout(() => {
        if (toast.parentNode) {
          toast.parentNode.removeChild(toast);
        }
      }, 300);
    }, duration);
  }

  document.getElementById('contactForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const submitButton = e.target.querySelector('button[type="submit"]');
    const originalText = submitButton.textContent;
    
    // Show loading state
    submitButton.textContent = 'Sending...';
    submitButton.disabled = true;
    
    try {
      const formData = new FormData(e.target);
      const data = {
        name: formData.get('name'),
        email: formData.get('email'),
        phone: formData.get('phone'),
        address: formData.get('address'),
        message: formData.get('message')
      };
      
      const response = await fetch('/api/contact', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(data)
      });
      
      const result = await response.json();
      
      if (result.success) {
        showToast('Message sent successfully! We\'ll get back to you within 24 hours.', 'success');
        e.target.reset(); // Clear the form
      } else {
        showToast('Error: ' + (result.error || 'Failed to send message'), 'error');
      }
    } catch (error) {
      showToast('Error: Failed to send message. Please try again.', 'error');
    } finally {
      // Reset button state
      submitButton.textContent = originalText;
      submitButton.disabled = false;
    }
  });

  // Booking toggle function
  window.toggleBooking = function(button) {
    const bookingContainer = button.closest('.booking-container');
    const bookingContent = bookingContainer.querySelector('.booking-content');
    const bookingIcon = bookingContainer.querySelector('.booking-icon');
    
    const isActive = bookingContainer.classList.contains('active');
    
    if (isActive) {
      bookingContainer.classList.remove('active');
      bookingIcon.textContent = '+';
    } else {
      bookingContainer.classList.add('active');
      bookingIcon.textContent = '‚àí';
    }
  };

</script>

<style>
  /* Booking Collapsible Styles */
  .booking-toggle {
    width: 100%;
    background: transparent;
    border: none;
    text-align: left;
    cursor: pointer;
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0;
    transition: all 0.3s ease;
  }

  .booking-toggle:hover {
    opacity: 0.9;
  }

  .booking-toggle:active {
    transform: translateY(1px);
  }

  .booking-icon {
    font-size: 2rem;
    font-weight: 300;
    transition: transform 0.3s ease;
    color: var(--warm-amber-glow);
    min-width: 32px;
    text-align: center;
    line-height: 1;
  }

  .booking-container.active .booking-icon {
    transform: rotate(45deg);
  }

  .booking-content {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.3s ease;
  }

  .booking-container.active .booking-content {
    max-height: 2000px;
  }

  @media (max-width: 768px) {
    .booking-icon {
      font-size: 1.75rem;
    }
  }
</style>
